---
- name: Configuramos mirror local, para equipos en Greencore Solutions
  hosts: fisicos
  strategy: free
  tasks:
    - name: Cambia cr.archive por ubuntu-mirror
      replace: >
        regexp="deb http:\/\/cr.archive.ubuntu.com"
        replace="deb http://ubuntu-mirror.greencore.int"
        dest=/etc/apt/sources.list
      become: yes
    - name: Elimina lineas que referencien a backports
      lineinfile: >
        regexp="-backports"
        dest=/etc/apt/sources.list
        state=absent
      become: yes
    - name: Agregamos llave de GPG para Visual Code
      apt_key:
        url: https://packages.microsoft.com/keys/microsoft.asc
        state: present
        keyring: /etc/apt/trusted.gpg.d/microsoft.gpg
      become: yes
    - name: Agregamos llave de GPG para Node Source
      apt_key:
        url: https://deb.nodesource.com/gpgkey/nodesource.gpg.key
        state: present
        keyring: /etc/apt/trusted.gpg.d/nodesource.gpg
      become: yes
    - name: Agregamos llave de GPG para Visual Code
      apt_key:
        url: https://download.docker.com/linux/ubuntu/gpg
        state: present
        keyring: /etc/apt/trusted.gpg.d/docker.gpg
      become: yes
    - name: Crea archivo de fuentes para paquetes de Visual Code
      apt_repository:
        repo: deb [arch=amd64] https://packages.microsoft.com/repos/vscode stable main
      become: yes
    - name: add repo for nodesource
      apt_repository:
        repo: 'deb https://deb.nodesource.com/node_10.x {{ ansible_distribution_release }} main'
      become: yes
    - name: Crea archivo de fuentes para Docker-CE
      apt_repository:
        repo: 'deb [arch=amd64] https://download.docker.com/linux/ubuntu {{ ansible_distribution_release }} stable'
      become: yes
